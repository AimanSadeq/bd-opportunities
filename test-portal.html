<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIFM Portal - System Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #010131;
            border-bottom: 3px solid #5391D5;
            padding-bottom: 10px;
        }
        .test-item {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #e0e0e0;
        }
        .test-item.pass {
            border-left-color: #22c55e;
            background: #f0fdf4;
        }
        .test-item.fail {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        .test-item.warning {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }
        .status {
            font-weight: bold;
            margin-right: 10px;
        }
        button {
            background: #5391D5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #4380c4;
        }
        .summary {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç VIFM Portal System Test</h1>
        
        <div id="testResults">
            <p>Running system checks...</p>
        </div>
        
        <div style="margin-top: 20px;">
            <button onclick="runTests()">üîÑ Run Tests Again</button>
            <button onclick="clearData()">üóëÔ∏è Clear All Data</button>
            <button onclick="window.location.href='index.html'">üè† Go to Portal</button>
        </div>
        
        <div id="summary" class="summary" style="display:none;">
            <h3>Test Summary</h3>
            <div id="summaryContent"></div>
        </div>
    </div>

    <script>
        // Test functions
        const tests = {
            checkFiles: function() {
                const requiredFiles = [
                    'index.html',
                    'login.html', 
                    'vifm-main-menu.html',
                    'phase1.html',
                    'bd-module.html'
                ];
                
                const results = [];
                requiredFiles.forEach(file => {
                    // Try to check if file exists (this is a simple check)
                    fetch(file, { method: 'HEAD' })
                        .then(() => results.push({file, exists: true}))
                        .catch(() => results.push({file, exists: false}));
                });
                
                return {
                    name: 'File Check',
                    pass: true, // Will be updated based on actual check
                    message: 'Checking required HTML files...'
                };
            },
            
            checkSupabase: function() {
                const url = 'https://tdzwnqhuijdmqnzflvhz.supabase.co';
                const key = localStorage.getItem('SUPABASE_ANON_KEY');
                
                if (!window.supabase) {
                    return {
                        name: 'Supabase Library',
                        pass: false,
                        message: 'Supabase client library not loaded'
                    };
                }
                
                return {
                    name: 'Supabase Configuration',
                    pass: true,
                    message: 'Supabase client available'
                };
            },
            
            checkLocalStorage: function() {
                try {
                    localStorage.setItem('test', 'test');
                    localStorage.removeItem('test');
                    return {
                        name: 'Local Storage',
                        pass: true,
                        message: 'Local storage is working'
                    };
                } catch(e) {
                    return {
                        name: 'Local Storage',
                        pass: false,
                        message: 'Local storage is blocked or unavailable'
                    };
                }
            },
            
            checkSession: function() {
                const session = localStorage.getItem('session_token');
                const user = localStorage.getItem('user_data');
                
                if (session && user) {
                    const userData = JSON.parse(user);
                    return {
                        name: 'Session Status',
                        pass: true,
                        message: `Active session for: ${userData.full_name}`
                    };
                }
                
                return {
                    name: 'Session Status',
                    pass: null,
                    message: 'No active session (this is normal)'
                };
            },
            
            checkBrowser: function() {
                const browser = navigator.userAgent;
                const isMobile = /iPhone|iPad|iPod|Android/i.test(browser);
                
                return {
                    name: 'Browser Compatibility',
                    pass: true,
                    message: `Browser: ${isMobile ? 'Mobile' : 'Desktop'} - Compatible`
                };
            },
            
            checkProtocol: function() {
                const protocol = window.location.protocol;
                
                if (protocol === 'file:') {
                    return {
                        name: 'Protocol Check',
                        pass: false,
                        message: 'Running from file:// - Should use HTTP server'
                    };
                }
                
                return {
                    name: 'Protocol Check',
                    pass: true,
                    message: `Running on ${protocol} - Good!`
                };
            }
        };
        
        function runTests() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '';
            
            let passCount = 0;
            let failCount = 0;
            let warningCount = 0;
            
            // Run each test
            Object.values(tests).forEach(test => {
                const result = test();
                const div = document.createElement('div');
                div.className = 'test-item';
                
                if (result.pass === true) {
                    div.className += ' pass';
                    div.innerHTML = `<span class="status">‚úÖ PASS</span> ${result.name}: ${result.message}`;
                    passCount++;
                } else if (result.pass === false) {
                    div.className += ' fail';
                    div.innerHTML = `<span class="status">‚ùå FAIL</span> ${result.name}: ${result.message}`;
                    failCount++;
                } else {
                    div.className += ' warning';
                    div.innerHTML = `<span class="status">‚ö†Ô∏è INFO</span> ${result.name}: ${result.message}`;
                    warningCount++;
                }
                
                resultsDiv.appendChild(div);
            });
            
            // Show summary
            const summaryDiv = document.getElementById('summary');
            const summaryContent = document.getElementById('summaryContent');
            summaryDiv.style.display = 'block';
            
            let overallStatus = 'üéâ All systems operational!';
            if (failCount > 0) {
                overallStatus = '‚ö†Ô∏è Some issues detected - check failed tests above';
            }
            
            summaryContent.innerHTML = `
                <p><strong>${overallStatus}</strong></p>
                <p>‚úÖ Passed: ${passCount} | ‚ùå Failed: ${failCount} | ‚ö†Ô∏è Warnings: ${warningCount}</p>
                <p>Test completed at: ${new Date().toLocaleTimeString()}</p>
            `;
        }
        
        function clearData() {
            if (confirm('This will clear all local data. Are you sure?')) {
                localStorage.clear();
                sessionStorage.clear();
                alert('All local data cleared! Refresh the page to start fresh.');
                location.reload();
            }
        }
        
        // Run tests on load
        window.onload = function() {
            runTests();
        };
    </script>
</body>
</html>
