<!DOCTYPE html>
<html>
<head>
    <title>VIFM - Quick Admin Access</title>
    <script src="env.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #333; margin-top: 0; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
        }
        button:hover { background: #2563eb; }
        .message {
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
        }
        .error { background: #fee; color: #c00; }
        .success { background: #efe; color: #060; }
        .info { background: #eef; color: #006; }
    </style>
</head>
<body>
    <div class="card">
        <h1>üîß VIFM Admin Quick Access</h1>
        <div id="message"></div>
        
        <p>This page will help you access the admin dashboard directly.</p>
        
        <button onclick="createAdminSession()">Access Admin Dashboard</button>
        <button onclick="window.location.href='/login.html'" style="background: #6b7280;">Back to Login</button>
    </div>

    <script>
        const message = document.getElementById('message');
        
        function showMessage(text, type = 'info') {
            message.innerHTML = `<div class="message ${type}">${text}</div>`;
        }
        
        async function createAdminSession() {
            try {
                showMessage('Setting up admin session...', 'info');
                
                // Initialize Supabase
                const supabaseUrl = window.env.SUPABASE_URL;
                const supabaseKey = window.env.SUPABASE_ANON_KEY;
                
                if (!supabaseUrl || !supabaseKey) {
                    throw new Error('Supabase credentials not found');
                }
                
                const client = window.supabase.createClient(supabaseUrl, supabaseKey);
                
                // Get the admin profile from database
                const { data: profile, error: profileError } = await client
                    .from('profiles')
                    .select('*')
                    .eq('email', 'asadeq@viftraining.com')
                    .single();
                
                if (profileError || !profile) {
                    throw new Error('Admin profile not found: ' + (profileError?.message || 'Unknown error'));
                }
                
                // Create a session object
                const session = {
                    user: {
                        id: profile.id,
                        email: profile.email,
                        user_metadata: {
                            full_name: profile.full_name
                        }
                    },
                    profile: profile,
                    expires_at: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString()
                };
                
                // Store in sessionStorage
                sessionStorage.setItem('vifm_session', JSON.stringify(session));
                
                showMessage('‚úÖ Session created! Redirecting to dashboard...', 'success');
                
                // Redirect to dashboard
                setTimeout(() => {
                    window.location.href = '/vifm-main-menu.html';
                }, 1000);
                
            } catch (error) {
                console.error('Error:', error);
                showMessage('‚ùå Error: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html>